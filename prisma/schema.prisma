generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Event {
  id              Int      @id @default(autoincrement())
  source          String   // Base, Medium, GitHub, etc.
  type            String   // Announcement, TokenMovement, etc.
  severity        String   @default("info") // info, medium, high, critical
  title           String
  summary         String
  details         String?
  sourceUrl       String?
  timestamp       DateTime @default(now())
  tags            String?  // JSON string array
  entities        String?  // JSON object strings {contracts[], wallets[], txHash?}
  rawRef          String?  @unique // unique identifier to prevent duplicates
}

model Insight {
  id          Int      @id @default(autoincrement())
  type        String   // Pattern, Whale, Campaign
  title       String
  content     String
  score       Float    @default(0)
  timestamp   DateTime @default(now())
}

model Prediction {
  id              Int      @id @default(autoincrement())
  title           String
  description     String
  probability     Float
  rationale       String
  targetDate      DateTime
  status          String   @default("PENDING") // PENDING, CONFIRMED, FAILED
  actualOutcome   String?
  evaluationDate  DateTime?
  timestamp       DateTime @default(now())
}

model WatcherState {
  id        String   @id // e.g., "base_logs", "medium_rss", "github"
  lastBlock Int?
  lastSeen  String?  // last seen RSS guid, timestamp, or SHA
}

model User {
  telegramId  String  @id
  carvId      String?
  evmAddress  String?
  isAdmin     Boolean @default(false)
  lang        String  @default("ar") // 'ar' (Egyptian) or 'en'
  lastInteractedAt DateTime?
}

model GroupSettings {
  chatId      String  @id
  mode        String  @default("chatty") // 'quiet', 'chatty'
  lang        String  @default("ar")
}

model Knowledge {
  id          Int      @id @default(autoincrement())
  question    String
  answer      String
  tags        String? // JSON array
  confidence  Float    @default(1.0)
  isTentative Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([question])
}

model Config {
  key   String @id
  value String
}

model Label {
  address String @id // Checksummed/Lowercase address
  name    String
}

model DailyStats {
  date               String @id // YYYY-MM-DD
  aiCalls            Int    @default(0)
  predictionAccuracy Float  @default(0)
}

model ErrorLog {
  id        Int      @id @default(autoincrement())
  message   String
  stack     String?
  timestamp DateTime @default(now())
}

// --- New Agent Tables ---

model Job {
  id        Int      @id @default(autoincrement())
  type      String   // 'digest', 'checkUrl', 'skill'
  cron      String?  // Cron expression
  data      String?  // JSON params
  lastRun   DateTime?
  nextRun   DateTime?
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
}

model Approval {
  token     String   @id
  userId    String
  action    String
  details   String?
  status    String   @default("PENDING") // PENDING, APPROVED, REJECTED, EXPIRED
  createdAt DateTime @default(now())
  expiresAt DateTime
}

model SkillRegistry {
  name        String @id
  description String
  enabled     Boolean @default(true)
  config      String? // JSON config
}

model MemoryFragment {
  id        Int      @id @default(autoincrement())
  category  String
  content   String
  timestamp DateTime @default(now())
  // embedding Bytes? // For future vector usage
}
